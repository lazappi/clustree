<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Creates a plot of a clustering tree overlaid on a scatter plot of individual
samples."><title>Overlay a clustering tree — clustree_overlay • clustree</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Overlay a clustering tree — clustree_overlay"><meta property="og:description" content="Creates a plot of a clustering tree overlaid on a scatter plot of individual
samples."><meta property="og:image" content="https://lazappi.github.io/clustree/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6GT3P9FP6F"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6GT3P9FP6F');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">clustree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/clustree.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lazappi/clustree/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Overlay a clustering tree</h1>
      <small class="dont-index">Source: <a href="https://github.com/lazappi/clustree/blob/HEAD/R/clustree_overlay.R" class="external-link"><code>R/clustree_overlay.R</code></a></small>
      <div class="d-none name"><code>clustree_overlay.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a plot of a clustering tree overlaid on a scatter plot of individual
samples.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">clustree_overlay</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for matrix</span></span>
<span><span class="fu">clustree_overlay</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">prefix</span>,</span>
<span>  <span class="va">metadata</span>,</span>
<span>  <span class="va">x_value</span>,</span>
<span>  <span class="va">y_value</span>,</span>
<span>  suffix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  count_filter <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  prop_filter <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  node_colour <span class="op">=</span> <span class="va">prefix</span>,</span>
<span>  node_colour_aggr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  node_size <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>  node_size_aggr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  node_size_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">15</span><span class="op">)</span>,</span>
<span>  node_alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  node_alpha_aggr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  edge_width <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  use_colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"edges"</span>, <span class="st">"points"</span><span class="op">)</span>,</span>
<span>  alt_colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  point_size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  point_alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  point_shape <span class="op">=</span> <span class="fl">18</span>,</span>
<span>  label_nodes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  label_size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  plot_sides <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  side_point_jitter <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>  side_point_offset <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for data.frame</span></span>
<span><span class="fu">clustree_overlay</span><span class="op">(</span><span class="va">x</span>, <span class="va">prefix</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for SingleCellExperiment</span></span>
<span><span class="fu">clustree_overlay</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">prefix</span>,</span>
<span>  <span class="va">x_value</span>,</span>
<span>  <span class="va">y_value</span>,</span>
<span>  exprs <span class="op">=</span> <span class="st">"counts"</span>,</span>
<span>  red_dim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for seurat</span></span>
<span><span class="fu">clustree_overlay</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">x_value</span>,</span>
<span>  <span class="va">y_value</span>,</span>
<span>  prefix <span class="op">=</span> <span class="st">"res."</span>,</span>
<span>  exprs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"raw.data"</span>, <span class="st">"scale.data"</span><span class="op">)</span>,</span>
<span>  red_dim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for Seurat</span></span>
<span><span class="fu">clustree_overlay</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">x_value</span>,</span>
<span>  <span class="va">y_value</span>,</span>
<span>  prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">assay</span>, <span class="st">"_snn_res."</span><span class="op">)</span>,</span>
<span>  exprs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"counts"</span>, <span class="st">"scale.data"</span><span class="op">)</span>,</span>
<span>  red_dim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>object containing clustering data</p></dd>


<dt>...</dt>
<dd><p>extra parameters passed to other methods</p></dd>


<dt>prefix</dt>
<dd><p>string indicating columns containing clustering information</p></dd>


<dt>metadata</dt>
<dd><p>data.frame containing metadata on each sample that can be
used as node aesthetics</p></dd>


<dt>x_value</dt>
<dd><p>numeric metadata column to use as the x axis</p></dd>


<dt>y_value</dt>
<dd><p>numeric metadata column to use as the y axis</p></dd>


<dt>suffix</dt>
<dd><p>string at the end of column names containing clustering
information</p></dd>


<dt>count_filter</dt>
<dd><p>count threshold for filtering edges in the clustering
graph</p></dd>


<dt>prop_filter</dt>
<dd><p>in proportion threshold for filtering edges in the
clustering graph</p></dd>


<dt>node_colour</dt>
<dd><p>either a value indicating a colour to use for all nodes or
the name of a metadata column to colour nodes by</p></dd>


<dt>node_colour_aggr</dt>
<dd><p>if <code>node_colour</code> is a column name than a string
giving the name of a function to aggregate that column for samples in each
cluster</p></dd>


<dt>node_size</dt>
<dd><p>either a numeric value giving the size of all nodes or the
name of a metadata column to use for node sizes</p></dd>


<dt>node_size_aggr</dt>
<dd><p>if <code>node_size</code> is a column name than a string
giving the name of a function to aggregate that column for samples in each
cluster</p></dd>


<dt>node_size_range</dt>
<dd><p>numeric vector of length two giving the maximum and
minimum point size for plotting nodes</p></dd>


<dt>node_alpha</dt>
<dd><p>either a numeric value giving the alpha of all nodes or the
name of a metadata column to use for node transparency</p></dd>


<dt>node_alpha_aggr</dt>
<dd><p>if <code>node_aggr</code> is a column name than a string
giving the name of a function to aggregate that column for samples in each
cluster</p></dd>


<dt>edge_width</dt>
<dd><p>numeric value giving the width of plotted edges</p></dd>


<dt>use_colour</dt>
<dd><p>one of "edges" or "points" specifying which element to
apply the colour aesthetic to</p></dd>


<dt>alt_colour</dt>
<dd><p>colour value to be used for edges or points (whichever is
NOT given by <code>use_colour</code>)</p></dd>


<dt>point_size</dt>
<dd><p>numeric value giving the size of sample points</p></dd>


<dt>point_alpha</dt>
<dd><p>numeric value giving the alpha of sample points</p></dd>


<dt>point_shape</dt>
<dd><p>numeric value giving the shape of sample points</p></dd>


<dt>label_nodes</dt>
<dd><p>logical value indicating whether to add labels to
clustering graph nodes</p></dd>


<dt>label_size</dt>
<dd><p>numeric value giving the size of node labels is
<code>label_nodes</code> is <code>TRUE</code></p></dd>


<dt>plot_sides</dt>
<dd><p>logical value indicating whether to produce side on plots</p></dd>


<dt>side_point_jitter</dt>
<dd><p>numeric value giving the y-direction spread of
points in side plots</p></dd>


<dt>side_point_offset</dt>
<dd><p>numeric value giving the y-direction offset for
points in side plots</p></dd>


<dt>exprs</dt>
<dd><p>source of gene expression information to use as node aesthetics,
for <code>SingleCellExperiment</code> objects it must be a name in <code>assayNames(x)</code>, for
a <code>seurat</code> object it must be one of <code>data</code>, <code>raw.data</code> or <code>scale.data</code> and
for a <code>Seurat</code> object it must be one of <code>data</code>, <code>counts</code> or <code>scale.data</code></p></dd>


<dt>red_dim</dt>
<dd><p>dimensionality reduction to use as a source for x_value and
y_value</p></dd>


<dt>assay</dt>
<dd><p>name of assay to pull expression and clustering data from for
<code>Seurat</code> objects</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a <code>ggplot</code> object if <code>plot_sides</code> is <code>FALSE</code> or a list of <code>ggplot</code></p>


<p>objects if <code>plot_sides</code> is <code>TRUE</code></p>


    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Data sources</strong></p>
<p>Plotting a clustering tree requires information about which cluster each
sample has been assigned to at different resolutions. This information can
be supplied in various forms, as a matrix, data.frame or more specialised
object. In all cases the object provided must contain numeric columns with
the naming structure <code>PXS</code> where <code>P</code> is a prefix indicating that the column
contains clustering information, <code>X</code> is a numeric value indicating the
clustering resolution and <code>S</code> is any additional suffix to be removed. For
<code>SingleCellExperiment</code> objects this information must be in the <code>colData</code> slot
and for <code>Seurat</code> objects it must be in the <code>meta.data</code> slot. For all objects
except matrices any additional columns can be used as aesthetics.</p>
<p><strong>Filtering</strong></p>
<p>Edges in the graph can be filtered by adjusting the <code>count_filter</code> and
<code>prop_filter</code> parameters. The <code>count_filter</code> removes any edges that represent
less than that number of samples, while the <code>prop_filter</code> removes edges that
represent less than that proportion of cells in the node it points towards.</p>
<p><strong>Node aesthetics</strong></p>
<p>The aesthetics of the plotted nodes can be controlled in various ways. By
default the colour indicates the clustering resolution, the size indicates
the number of samples in that cluster and the transparency is set to 100%.
Each of these can be set to a specific value or linked to a supplied metadata
column. For a <code>SingleCellExperiment</code> or <code>Seurat</code> object the names of genes
can also be used. If a metadata column is used than an aggregation function
must also be supplied to combine the samples in each cluster. This function
must take a vector of values and return a single value.</p>
<p><strong>Colour aesthetic</strong></p>
<p>The colour aesthetic can be applied to either edges or sample points by
setting <code>use_colour</code>. If "edges" is selected edges will be coloured according
to the clustering resolution they originate at. If "points" is selected they
will be coloured according to the cluster they are assigned to at the highest
resolution.</p>
<p><strong>Dimensionality reductions</strong></p>
<p>For <code>SingleCellExperiment</code> and <code>Seurat</code> objects precomputed dimensionality
reductions can be used for x or y aesthetics. To do so <code>red_dim</code> must be set
to the name of a dimensionality reduction in <code>reducedDimNames(x)</code> (for a
<code>SingleCellExperiment</code>) or <code>x@dr</code> (for a <code>Seurat</code> object). <code>x_value</code> and
<code>y_value</code> can then be set to <code>red_dimX</code> when <code>red_dim</code> matches the <code>red_dim</code>
argument and <code>X</code> is the column of the dimensionality reduction to use.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nba_clusts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">clustree_overlay</span><span class="op">(</span><span class="va">nba_clusts</span>, prefix <span class="op">=</span> <span class="st">"K"</span>, x_value <span class="op">=</span> <span class="st">"PC1"</span>, y_value <span class="op">=</span> <span class="st">"PC2"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="clustree_overlay-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Luke Zappia, Alicia Oshlack.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

